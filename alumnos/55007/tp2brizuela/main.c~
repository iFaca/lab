#include "histograma.h"

int main(int argc,char *argv[])
{
	system("/usr/bin/clear");
	char buffer[10];
	int leido,orden,hijos,i,palabras,j,estado;
	float por;

	//Entrada estandar
	leido = read(0,buffer,sizeof buffer);
	write(1, buffer, leido);
	printf("leido=%d\n",leido);

	// -n , -o , numero de hijos y orden
	orden=parametros(argv[1],argv[3],argv[2],argv[4]);//defino el orden en el que quiero los parametros, funcion: parametros.c
	hijos=atoi(argv[2]);//numero de hijos lo paso a int
	
	//analizar cadena
	palabras=romper(buffer,leido);//da el numero de palabras con la funcion romper.c
	printf("\n");
	
	//creacion de hijos
	int fd[2],fd1[2],fd2[2],*ptr,*ptr2,*ptr3,*ptr4;
	char aux[leido];
	pipe(fd);
	pipe(fd1);
	pipe(fd2);
	write(fd[1],buffer,leido);
	for(i=0;i<hijos;i++){
		if(fork()==0){//hijos
				if(i != hijos-1){
					close(fd[1]);
					while(read(fd[0],aux, leido)>0){
						printf("\n PID=%d\n",getpid());
						ptr=distribucion(aux,leido);//arma un vector de distribucion
						write(fd1[1],ptr,leido);
						printf("valor1=%d\n",ptr[4]);
						break;
					}
				}else{//monitor
					close (fd1[1]);
					while (read(fd1[0],ptr2,leido)>0){
						ptr3=ordenar(orden,ptr2);
						write(fd2[1],ptr3,leido);
						printf("valor2=%d\n",ptr3[4]);
						break;
					}
				}
		}
	}
	wait(0);
	return 0;
}

